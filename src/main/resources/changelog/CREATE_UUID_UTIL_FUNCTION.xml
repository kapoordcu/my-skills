<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.6.xsd">

    <changeSet id="EBETRISK-44-2" author="kapoor, ninjas">
        <preConditions onFail="MARK_RAN">
            <not>
                <dbms type="H2"/>
            </not>
        </preConditions>
        <comment> add util funtions for uuid conversion</comment>
        <sql >

            DROP FUNCTION IF EXISTS uuidToBin;

            CREATE FUNCTION uuidToBin(_uuid BINARY(36))
            RETURNS BINARY(16)
            LANGUAGE SQL  DETERMINISTIC  CONTAINS SQL  SQL SECURITY INVOKER
            RETURN
            UNHEX(CONCAT(
            SUBSTR(_uuid,  1, 8),
            SUBSTR(_uuid, 10, 4),
            SUBSTR(_uuid, 15, 4),
            SUBSTR(_uuid, 20, 4),
            SUBSTR(_uuid, 25) ));


            DROP FUNCTION IF EXISTS binToUuid;

            CREATE FUNCTION binToUuid(_bin BINARY(16))
            RETURNS varchar(36)
            LANGUAGE SQL  DETERMINISTIC  CONTAINS SQL  SQL SECURITY INVOKER
            RETURN
            convert(LCASE(CONCAT_WS('-',
            HEX(SUBSTR(_bin,  1, 4)),
            HEX(SUBSTR(_bin,  5, 2)),
            HEX(SUBSTR(_bin,  7, 2)),
            HEX(SUBSTR(_bin,  9, 2)),
            HEX(SUBSTR(_bin, 11))
            )) using utf8);

        </sql>
    </changeSet>
</databaseChangeLog>